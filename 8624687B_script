#!/bin/bash

# Variables
CONTAINER=$1   # Accept container name as an argument
REPO_DIR="/tmp/8624687B/research"
GIT_REPO="https://github.com/sunaly23/8624687B_op_repo.git"
HTML_SRC="/tmp/8624687B_op_repo/8624687B_index.html"
HTML_DST="/var/www/html/index.html"

echo "Starting Bolt script execution on $CONTAINER..."

# Ensure Apache2 is installed and running
echo "Ensuring Apache2 is installed..."
docker exec -it $CONTAINER bash -c "apt update && apt install -y apache2 && systemctl start apache2 && systemctl enable apache2"

# Remove old research directory
echo "Cleaning up old research directory..."
docker exec -it $CONTAINER bash -c "rm -rf $REPO_DIR && mkdir -p $REPO_DIR"

# Clone the latest repository into the container
echo "Cloning the repository into $CONTAINER..."
docker exec -it $CONTAINER bash -c "git clone $GIT_REPO $REPO_DIR"

# Replace the index.html with the latest file
echo "Updating index.html..."
docker exec -it $CONTAINER bash -c "cp $HTML_SRC $HTML_DST"

# Restart Apache to apply changes
echo "Restarting Apache2..."
docker exec -it $CONTAINER bash -c "systemctl restart apache2"

echo "Script execution completed for $CONTAINER!"
